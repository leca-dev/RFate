<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create clusters based on dissimilarity matrix — PRE_FATE.speciesClustering_step1 • RFate</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create clusters based on dissimilarity matrix — PRE_FATE.speciesClustering_step1"><meta property="og:description" content="This script is designed to create clusters of species based 
on a distance matrix between those species. Several metrics are computed 
to evaluate these clusters and a graphic is produced to help the user to 
choose the best number of clusters.."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RFate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fab fa-pagelines"></span>
     
    FATE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="divider">
    <li>
      <a href="../articles/fate_tutorial_0_publications.html">Publications</a>
    </li>
    <li>
      <a href="../articles/fate_tutorial_0_modelling_framework.html">Modelling framework</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/fate_tutorial_1_PFG.html">a. Principle of PFG</a>
    </li>
    <li>
      <a href="../articles/fate_tutorial_2_RUN_SIMULATION.html">b. Run a FATE simulation</a>
    </li>
    <li>
      <a href="../articles/fate_tutorial_3_MODULES.html">c. Use a FATE module</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-toolbox"></span>
     
    RFate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="divider">
    <li>
      <a href="../articles/rfate_tutorial_1_PFG.html">
        <span class="fa fa-battery-quarter"></span>
         
        Build PFG
      </a>
    </li>
    <li>
      <a href="../articles/rfate_tutorial_2_params.html">
        <span class="fa fa-battery-half"></span>
         
        Build parameter files
      </a>
    </li>
    <li>
      <a href="../articles/rfate_tutorial_3_graphics.html">
        <span class="fa fa-battery-three-quarters"></span>
         
        Build graphics
      </a>
    </li>
    <li class="divider">
  </ul></li>
<li>
  <a href="../articles/interface_tutorial_0_presentation.html">
    <span class="fas fa-desktop"></span>
     
    SHINY interface
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-book fa-lg"></span>
     
    Reference
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="../articles/manual.html">
    <span class="fas fa-stethoscope"></span>
     
    Manual &amp; Examples
  </a>
</li>
<li>
  <a href="../articles/news.html">
    <span class="far fa-newspaper"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/leca-dev/RFate.git" class="external-link">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create clusters based on dissimilarity matrix</h1>
    <small class="dont-index">Source: <a href="https://github.com/leca-dev/RFate.git/blob/HEAD/R/PRE_FATE.speciesClustering_step1.R" class="external-link"><code>R/PRE_FATE.speciesClustering_step1.R</code></a></small>
    <div class="hidden name"><code>PRE_FATE.speciesClustering_step1.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This script is designed to create clusters of species based 
on a distance matrix between those species. Several metrics are computed 
to evaluate these clusters and a graphic is produced to help the user to 
choose the best number of clusters..</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">PRE_FATE.speciesClustering_step1</span><span class="op">(</span><span class="va">mat.species.DIST</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>mat.species.DIST</dt>
<dd><p>a <code>dist</code> object, or a <code>list</code> of 
<code>dist</code> objects (one for each <code>GROUP</code> value), corresponding to the 
dissimilarity distance between each pair of species. <br> Such an object can 
be obtained with the <code><a href="PRE_FATE.speciesDistance.html">PRE_FATE.speciesDistance</a></code> function.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>list</code> containing one <code>list</code>, one <code>data.frame</code> with 
the following columns, and two <code>ggplot2</code> objects :</p><dl><dt>clust.dendrograms</dt>
<dd><p>a <code>list</code> with as many objects of 
  class <code><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></code> as data subsets</p></dd>

  <dt>clust.evaluation</dt>
<dd><p><br></p><dl><dt><code>GROUP</code></dt>
<dd><p>name of data subset</p></dd>

    <dt><code>no.clusters</code></dt>
<dd><p>number of clusters used for the clustering</p></dd>

    <dt><code>variable</code></dt>
<dd><p>evaluation metrics' name</p></dd>

    <dt><code>value</code></dt>
<dd><p>value of evaluation metric <br><br></p></dd>

  
</dl><p></p></dd>

  <dt>plot.clustMethod</dt>
<dd><p><code>ggplot2</code> object, representing the different 
  values of metrics to choose the clustering method</p></dd>

  <dt>plot.clustNo</dt>
<dd><p><code>ggplot2</code> object, representing the different 
  values of metrics to choose the number of clusters <br><br></p></dd>


</dl><p>One <code class="file">PRE_FATE_CLUSTERING_STEP1_numberOfClusters.pdf</code> file is created 
containing two types of graphics :</p><dl><dt>clusteringMethod</dt>
<dd><p>to account for the chosen clustering method</p></dd>

  <dt>numberOfClusters</dt>
<dd><p>for decision support, to help the user to choose 
  the adequate number of clusters to be given to the 
  <code><a href="PRE_FATE.speciesClustering_step2.html">PRE_FATE.speciesClustering_step2</a></code> function</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function allows to <strong>obtain dendrograms based on a dissimilarity 
distance matrix between species</strong>.</p>
<p>As for the <code><a href="PRE_FATE.speciesDistance.html">PRE_FATE.speciesDistance</a></code> method, clustering can be 
run for data subsets, conditioning that <code>mat.species.DIST</code> is given as 
a <code>list</code> of <code>dist</code> objects (instead of a <code>dist</code> object alone).
<br><br></p>
<p>The process is as follows :</p>
<dl><dt><strong>1. Choice of the <br> optimal <br> clustering method</strong></dt>
<dd><p>hierarchical clustering on the dissimilarity matrix is realized with the 
  <code><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></code>.</p><ul><li><p>Several methods are available for the agglomeration : 
    <em>complete</em>, <em>ward.D</em>, <em>ward.D2</em>, <em>single</em>, 
    <em>average (UPGMA)</em>, <em>mcquitty (WPGMA)</em>, <em>median (WPGMC)</em> 
    and <em>centroid (UPGMC)</em>.</p></li>
<li><p><em>Mouchet et al. (2008)</em> proposed a similarity measure between 
    the input distance and the one obtained with the clustering which must 
    be minimized to help finding the best clustering method :
    $$ 1 - cor( \text{mat.species.DIST}, \text{clustering.DIST} ) ^ 2$$</p></li>
</ul><p><strong>For each agglomeration method, this measure is calculated. The 
  method that minimizes it is kept and used for further analyses (see 
  <code class="file">.pdf</code> output file). <br><br></strong></p></dd>

  
  <dt><strong>2. Evaluation of the <br> clustering</strong></dt>
<dd><p>once the hierarchical 
  clustering is done, the number of clusters to keep should be chosen. <br> 
  To do that, several metrics are computed :</p><ul><li><p><em>Dunn index (<code>mdunn</code>) : </em>ratio of the smallest 
    distance between observations not in the same cluster to the largest 
    intra-cluster distance. Value between <code>0</code> and \(\infty\), and 
    should be maximized.</p></li>
<li><p><em>Meila's Variation of Information index (<code>mVI</code>) : </em>
    measures the amount of information lost and gained in changing 
    between two clusterings. Should be minimized.</p></li>
<li><p><em>Coefficient of determination (<code>R2</code>) : </em>value 
    between <code>0</code> and <code>1</code>. Should be maximized.</p></li>
<li><p><em>Calinski and Harabasz index (<code>ch</code>) : </em>the higher 
    the value, the "better" is the solution.</p></li>
<li><p><em>Corrected rand index (<code>Rand</code>) : </em>measures the 
    similarity between two data clusterings. Value between <code>0</code> and 
    <code>1</code>, with <code>0</code> indicating that the two data clusters do not 
    agree on any pair of points and <code>1</code> indicating that the data 
    clusters are exactly the same.</p></li>
<li><p><em>Average silhouette width (<code>av.sil</code>) : </em>Observations 
    with a large <code>s(i)</code> (almost <code>1</code>) are very well clustered, a 
    small <code>s(i)</code> (around <code>0</code>) means that the observation lies 
    between two clusters, and observations with a negative <code>s(i)</code> are 
    probably placed in the wrong cluster. Should be maximized.</p></li>
</ul><p><strong>A graphic is produced, giving the values of these metrics in 
  function of the number of clusters used. Number of clusters are 
  highlighted in function of evaluation metrics' values to help the 
  user to make his/her optimal choice : the brighter (yellow-ish) the 
  better (see <code class="file">.pdf</code> output file).</strong></p></dd>


</dl><p><em><br><br>
Mouchet M., Guilhaumon f., Villeger S., Mason N.W.H., Tomasini J.A. &amp; 
Mouillot D., 2008. Towards a consensus for calculating dendrogam-based 
functional diversity indices. Oikos, 117, 794-800.</em></p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p><strong>The function does not return ONE dendrogram</strong> (or as many as 
given dissimilarity structures) <strong>but a LIST with all tested numbers 
of clusters.</strong> One final dendrogram can then be obtained using this result 
as a parameter in the <code><a href="PRE_FATE.speciesClustering_step2.html">PRE_FATE.speciesClustering_step2</a></code> 
function.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></code>,
<code><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></code>,
<code>cluster.stats</code>,
<code>dunn</code>,
<code><a href="PRE_FATE.speciesDistance.html">PRE_FATE.speciesDistance</a></code>,
<code><a href="PRE_FATE.speciesClustering_step2.html">PRE_FATE.speciesClustering_step2</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Isabelle Boulangeat, Maya Guéguen</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code>
<span class="co">## Load example data</span>
<span class="va">Champsaur_PFG</span> <span class="op">=</span> <span class="fu"><a href="dot-loadData.html">.loadData</a></span><span class="op">(</span><span class="st">'Champsaur_PFG'</span>, <span class="st">'RData'</span><span class="op">)</span>

<span class="co">## Species dissimilarity distances (niche overlap + traits distance)</span>
<span class="va">tab.dist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'Phanerophyte'</span> <span class="op">=</span> <span class="va">Champsaur_PFG</span><span class="op">$</span><span class="va">sp.DIST.P</span><span class="op">$</span><span class="va">mat.ALL</span>
                , <span class="st">'Chamaephyte'</span> <span class="op">=</span> <span class="va">Champsaur_PFG</span><span class="op">$</span><span class="va">sp.DIST.C</span><span class="op">$</span><span class="va">mat.ALL</span>
                , <span class="st">'Herbaceous'</span> <span class="op">=</span> <span class="va">Champsaur_PFG</span><span class="op">$</span><span class="va">sp.DIST.H</span><span class="op">$</span><span class="va">mat.ALL</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tab.dist</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">tab.dist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>

<span class="co">## Build dendrograms ---------------------------------------------------------</span>
<span class="va">sp.CLUST</span> <span class="op">=</span> <span class="fu">PRE_FATE.speciesClustering_step1</span><span class="op">(</span>mat.species.DIST <span class="op">=</span> <span class="va">tab.dist</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sp.CLUST</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sp.CLUST</span><span class="op">$</span><span class="va">clust.evaluation</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sp.CLUST</span><span class="op">$</span><span class="va">plot.clustMethod</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sp.CLUST</span><span class="op">$</span><span class="va">plot.clustNo</span><span class="op">)</span>

<span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andrie/ggdendro" class="external-link">ggdendro</a></span><span class="op">)</span>
<span class="va">pp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sp.CLUST</span><span class="op">$</span><span class="va">clust.dendrograms</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%do%</a></span>
<span class="op">{</span>
  <span class="va">hc</span> <span class="op">=</span> <span class="va">sp.CLUST</span><span class="op">$</span><span class="va">clust.dendrograms</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>
  <span class="va">pp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/ggdendrogram.html" class="external-link">ggdendrogram</a></span><span class="op">(</span><span class="va">hc</span>, rotate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Hierarchical clustering based on species distance '</span>
                        , <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sp.CLUST</span><span class="op">$</span><span class="va">clust.dendrograms</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span>
                                 , <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'(group '</span>, <span class="va">x</span>, <span class="st">')'</span><span class="op">)</span>
                                 , <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pp</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pp</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pp</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>



</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="http://www.will.chez-alice.fr/" class="external-link">Wilfried Thuiller</a>, Damien Georges, <a href="https://iboulangeat.github.io/" class="external-link">Isabelle Boulangeat</a>, <a href="https://mayagueguen.github.io" class="external-link">Maya Guéguen</a>, Guillaume Dupouy.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

